<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Wireshark Packet Analysis Dashboard</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body { background-color: #0b0f14; color: #e9eef5; }
    .card { background-color: #101720; border: 1px solid #1e2a36; }
    .table-dark th, .table-dark td { color: #e9eef5; }
    .scrollable-table { max-height: 300px; overflow-y: auto; }
  </style>
</head>
<body>
  <div class="container-fluid py-3">
    <div class="d-flex justify-content-between align-items-center mb-3">
      <h3>Wireshark Packet Analysis Dashboard</h3>
      <input type="file" id="fileInput" accept=".csv" class="form-control" style="width:250px;">
    </div>

    <div class="row g-3">
      <!-- Protocol Distribution -->
      <div class="col-md-4">
        <div class="card p-3">
          <h6>Protocol Distribution</h6>
          <canvas id="protocolChart"></canvas>
        </div>
      </div>

      <!-- Top Talkers -->
      <div class="col-md-4">
        <div class="card p-3">
          <h6>Top Talkers</h6>
          <table class="table table-dark table-striped table-sm">
            <thead><tr><th>IP Address</th><th>Packets</th></tr></thead>
            <tbody id="topTalkers"></tbody>
          </table>
        </div>
      </div>

      <!-- Packet Size Distribution -->
      <div class="col-md-4">
        <div class="card p-3">
          <h6>Packet Size Distribution</h6>
          <canvas id="sizeChart"></canvas>
        </div>
      </div>

      <!-- Suspicious IPs -->
      <div class="col-md-12">
        <div class="card p-3">
          <h6>Suspicious IPs (>=120 packets)</h6>
          <ul id="suspiciousList" class="text-danger small"></ul>
        </div>
      </div>

      <!-- Full Packet Table -->
      <div class="col-md-12">
        <div class="card p-3">
          <h6>Full Packet Table</h6>
          <div class="scrollable-table">
            <table class="table table-dark table-striped table-sm">
              <thead>
                <tr>
                  <th>No.</th>
                  <th>Time</th>
                  <th>Source</th>
                  <th>Destination</th>
                  <th>Protocol</th>
                  <th>Length</th>
                  <th>Info</th>
                </tr>
              </thead>
              <tbody id="packetTableBody"></tbody>
            </table>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    let protocolChart, sizeChart;

    document.getElementById('fileInput').addEventListener('change', handleFileUpload);

    function handleFileUpload(event) {
      const file = event.target.files[0];
      if (!file) return;

      const reader = new FileReader();
      reader.onload = function(e) {
        const text = e.target.result;
        processCSV(text);
      };
      reader.readAsText(file);
    }

    function processCSV(data) {
      const lines = data.trim().split('\n');
      const headers = lines[0].split(',');
      const rows = lines.slice(1).map(line => line.split(','));

      const protocolCount = {};
      const srcCount = {};
      const sizeBins = { '<100B': 0, '100-499B': 0, '500B-1.4KB': 0, '>=1.5KB': 0 };
      const suspiciousIPs = {};

      const tableBody = document.getElementById('packetTableBody');
      tableBody.innerHTML = '';

      rows.forEach((cols, idx) => {
        const [no, time, source, destination, protocol, length, info] = cols;
        const len = parseInt(length) || 0;

        // --- Fill Table ---
        const row = document.createElement('tr');
        row.innerHTML = `<td>${no}</td><td>${time}</td><td>${source}</td><td>${destination}</td><td>${protocol}</td><td>${length}</td><td>${info || ''}</td>`;
        tableBody.appendChild(row);

        // --- Count Protocols ---
        protocolCount[protocol] = (protocolCount[protocol] || 0) + 1;

        // --- Count Source IPs ---
        srcCount[source] = (srcCount[source] || 0) + 1;

        // --- Packet Size Binning ---
        if (len < 100) sizeBins['<100B']++;
        else if (len < 500) sizeBins['100-499B']++;
        else if (len < 1500) sizeBins['500B-1.4KB']++;
        else sizeBins['>=1.5KB']++;
      });

      // --- Suspicious IPs Logic (>=120 packets) ---
      for (const [ip, count] of Object.entries(srcCount)) {
        if (count >= 120) {
          suspiciousIPs[ip] = count;
        }
      }

      updateCharts(protocolCount, sizeBins);
      updateTopTalkers(srcCount);
      updateSuspiciousList(suspiciousIPs);
    }

    function updateCharts(protocolCount, sizeBins) {
      const protoLabels = Object.keys(protocolCount);
      const protoData = Object.values(protocolCount);

      if (protocolChart) protocolChart.destroy();
      protocolChart = new Chart(document.getElementById('protocolChart'), {
        type: 'pie',
        data: {
          labels: protoLabels,
          datasets: [{ data: protoData, backgroundColor: ['#00bcd4', '#ff9800', '#8bc34a', '#e91e63', '#9c27b0', '#3f51b5'] }]
        }
      });

      const sizeLabels = Object.keys(sizeBins);
      const sizeData = Object.values(sizeBins);
      if (sizeChart) sizeChart.destroy();
      sizeChart = new Chart(document.getElementById('sizeChart'), {
        type: 'bar',
        data: {
          labels: sizeLabels,
          datasets: [{ label: 'Packet Count', data: sizeData, backgroundColor: '#00bcd4' }]
        },
        options: { scales: { y: { beginAtZero: true } } }
      });
    }

    function updateTopTalkers(srcCount) {
      const sorted = Object.entries(srcCount).sort((a, b) => b[1] - a[1]).slice(0, 10);
      const tbody = document.getElementById('topTalkers');
      tbody.innerHTML = '';
      sorted.forEach(([ip, count]) => {
        const tr = document.createElement('tr');
        tr.innerHTML = `<td>${ip}</td><td>${count}</td>`;
        tbody.appendChild(tr);
      });
    }

    function updateSuspiciousList(suspiciousIPs) {
      const list = document.getElementById('suspiciousList');
      list.innerHTML = '';
      if (Object.keys(suspiciousIPs).length === 0) {
        list.innerHTML = '<li>No suspicious activity detected.</li>';
      } else {
        Object.entries(suspiciousIPs).forEach(([ip, count]) => {
          const li = document.createElement('li');
          li.textContent = `${ip} â†’ ${count} packets`;
          list.appendChild(li);
        });
      }
    }
  </script>
</body>
</html>
